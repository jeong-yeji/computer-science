# 페이지 교체와 프레임 할당

1. 스와핑할 불필요한 페이지 선별 => **페이지 교체**

2. 프로세스에게 할당할 프레임의 수 => **프레임 할당**

## 요구 페이지(demand paging)

- 처음부터 모든 페이지를 적재하지 않고 **필요한 페이지만 메모리에 적재**하는 방법

- 요구되는 페이지만 적재하는 방법
1. CPU가 특정 페이지에 접근하는 명령어를 실행한다.

2. 해당 페이지가 메모리가 있다면(유효 비트==1) CPU는 페이지에 적재된 프레임에 접근한다.

3. 해당 페이지가 메모리에 없다면(유효 비트==0) 페이지 폴트가 발생한다.

4. 페이지 폴트 처리 루틴은 해당 페이지를 메모리로 적재하고 유효 비트를 1로 설정한다.

5. 1번부터 반복
- 순수 요구 페이징(pure demand paging)
  
  - 아무 페이지도 적재하지 않은 상태에서 프로그램을 실행하는 것
  
  - 처음에는 계속 페이지 폴트 발생하다가 점차 페이지 포트 발생 빈도 줄어듦

## 페이지 교체 알고리즘

- swap-out할 페이지를 결정하는 방법

- 페이지 폴트를 적게 발생할수록 좋음

- 페이지 폴트 횟수를 알 수 있는 방법 => **페이지 참조열(page reference string)**
  
  - CPU가 참조하는 페이지들 중 연속된 페이지를 생략한 페이지열
  
  - `2 2 2 3 5 5 5 3 3 7` -> `2 3 5 3 7`

- **FIFO 페이지 교체 알고리즘**
  
  - 메모리에 가장 먼저 적재된(오래된) 페이지부터 교체
  
  - 성능면에서 좋지 않음

- **2차 기회(second-chance) 페이지 교체 알고리즘**
  
  - 참조비트 참고하여 오래된 페이지부터 교체
  
  - 참조 비트 `1` : CPU가 참조한 적이 있는 페이지 => 참보 비트 0으로 초기화 후, 적재된 시간을 현재 시간으로 설정 (가장 최근에 적재된 페이지로 간주)
  
  - 참조 비트 `0` : CPU가 참조한 적이 없는 페이지 => **교체**

- **최적 페이지 교체 알고리즘**
  
  - CPU가 참조하는 횟수를 고려해서 교체
  
  - 앞으로의 사용 빈도가 가장 낮은 페이지를 교체하는 알고리즘
  
  - 가장 낮은 페이지 폴트율을 보장
  
  - 실제 구현이 어려움

- **LRU(Least-Recently-Used) 페이지 교체 알고리즘**
  
  - 가장 오래 사용되지 않은 페이지 교체

## 스래싱과 프레임 할당

- 페이지 폴트가 자주 발생하는 이유
  
  - 나쁜 페이지 교체 알고리즘
  
  - 프로세스가 사용 가능한 프레임 수가 적음

- **스래싱(thrashing)**
  
  - 프로세스가 실행되는 시간보다 **페이징에 더 많은 시간을 소요**해서 성능(CPU 이용률)이 저해되는 문제
  
  - 동시에 실행되는 프로세스의 수를 늘릴수록 CPU의 이용률이 높아지지만 일정 지점이 지나면 스래싱이 발생해 오히려 CPU 이용률이 떨어짐
  
  - 각 프로세스가 필요로 하는 **최소 프레임 수를 보장**하지 않아 발생
  
  - OS는 각 프로세스가 무리없이 실행 가능한 프레임 수를 파악하고 할당해야됨

- 프레임 할당 방식
  
  - **균등 할당(equal allocation)**
    
    - 모든 프로세스들에게 **균등하게** 프레임을 할당하는 방식
    
    - 프로세스들의 크기가 다 다른데 균등하게 할당하는 것은 비합리적
  
  - **비례 할당(proportional allocation)**
    
    - **프로세스의 크기에 비례**해 프레임을 할당하는 방식
    
    - 프로세스의 크기와 프레임 수가 항상 비례하는 것은 아님
    
    - 프로세스가 필요로하는 프레임의 수는 실행해야 알 수 있음
  
  - **작업 집합 모델(working set model) 기반**
    
    - CPU가 특정 시간동안 **주로 참조한 페이지 개수**만큼 프레임 할당
    
    - 작업 집합을 기억해 빈번한 페이지 교체 방지
      
      - 작업 집합
        
        - 실행 중인 프로세스가 일정 시간동안 참조한 페이지의 집합
        
        - 프로세스가 참조한 페이지와 시간 간격을 통해 구할 수 있음
  
  - **페이지 폴트 빈도(PPF; Page-Fault Frequency) 기반**
    
    - 페이지 폴트율과 프로세스가 가진 프레임의 수는 반비례
    
    - 페이지 폴트율의 상한선과 하한선을 정하고, 범위 안에서만 프레임을 할당하는 방식

- 정적 할당 방식
  
  - 프로세스의 실행 과정을 고려하지 않고 프로세스의 크기나 메모리의 크기만 고려한 방식
  
  - e,g., 균등 할당, 비례 할당

- 동적 할당 방식
  
  - 프로세스 실행 과정에서 프레임 할당 방식 고려
  
  - e.g., 작업 집합 모델, 페이지 폴트 빈도
